/*!
 * jQuery Raty - A Star Rating Plugin - http://wbotelhos.com/raty
 * 
 * @author  Washington Botelho
 * @twitter wbotelhos
 * @version 1.4.3
 * 
 * Licensed under The MIT License
 * http://opensource.org/licenses/mit-license.php
 * 
 */

(function(d){d.fn.raty=function(r){if(this.length==0){a("Selector invalid or missing!");return}else{if(this.length>1){return this.each(function(){d.fn.raty.apply(d(this),[r])})}}var n=d.extend({},d.fn.raty.defaults,r),u=d(this),k=u.attr("id"),m=(n.width)?n.width:(n.number*n.size+n.number*4);if(k===undefined||k==""){k="raty-"+u.index();u.attr("id",k)}u.data("options",n);if(n.number>20){n.number=20}else{if(n.number<0){n.number=0}}if(n.path.substring(n.path.length-1,n.path.length)!="/"){n.path+="/"}var p=!isNaN(parseInt(n.start,10))&&n.start>0,l=0;if(p){l=(n.start>n.number)?n.number:n.start}else{if(typeof n.start=="function"){l=n.start.call(this)}}var v=n.starOn,s="";for(var t=1;t<=n.number;t++){v=(l<t)?n.starOff:n.starOn;s=(t<=n.hintList.length&&n.hintList[t-1]!==null)?n.hintList[t-1]:t;u.append('<img id="'+k+"-"+t+'" src="'+n.path+v+'" alt="'+t+'" title="'+s+'" class="'+k+'"/>').append((t<n.number)?"&nbsp;":"")}if(n.iconRange&&p){b(u,l)}if(n.halfShow){g(u,l)}c(l,n);var q=d("<input/>",{id:k+"-score",type:"hidden",name:n.scoreName}).appendTo(u);if(p){q.val(l)}if(!n.readOnly){if(n.cancel){var o=u.children("img."+k),w='<img src="'+n.path+n.cancelOff+'" alt="x" title="'+n.cancelHint+'" class="button-cancel"/>';if(n.cancelPlace=="left"){u.prepend(w+"&nbsp;")}else{u.append("&nbsp;").append(w)}u.children("img.button-cancel").mouseenter(function(){d(this).attr("src",n.path+n.cancelOn);o.attr("src",n.path+n.starOff);c(null,n)}).mouseleave(function(){d(this).attr("src",n.path+n.cancelOff);u.mouseout()}).click(function(x){q.removeAttr("value");if(n.click){n.click.apply(u,[null,x])}});u.css("width",m+n.size+4)}else{u.css("width",m)}u.css("cursor","pointer");f(u,n)}else{u.css("cursor","default");j(u,l)}return u};function f(l,k){var o=l.attr("id"),m=d("input#"+o+"-score"),n=l.children("img."+o);l.mouseleave(function(){e(l,m.val());c(m.val(),k,!k.targetKeep)});n.bind(((k.half)?"mousemove":"mouseover"),function(s){var q=parseInt(this.alt,10);if(k.half){var p=parseFloat(((s.pageX-d(this).offset().left)/k.size).toFixed(2)),r=(p>0.5)?1:0.5;q=parseFloat(this.alt)-1+r;l.data("score",q)}b(l,q);if(k.half){g(l,q)}c(q,k)}).click(function(p){m.val(k.half?l.data("score"):this.alt);if(k.click){k.click.apply(l,[m.val(),p])}})}function c(n,m,l){if(m.target){var k=d(m.target);if(k.length==0){a(id+": target selector invalid or missing!")}else{if(l){n=m.targetOutValue}else{if(m.targetType=="hint"){if(n===null&&m.cancel){n=m.cancelHint}else{n=m.hintList[Math.ceil(n-1)]}}}if(h(k)){k.val(n)}else{k.html(n)}}}}function b(l,n){var m=l.data("options"),k=l.attr("id"),o=l.children("img."+k).length,t=0,r=0,s,p;for(var q=1;q<=o;q++){s=l.children("img#"+k+"-"+q);if(q<=n){if(m.iconRange&&m.iconRange.length>t){p=m.iconRange[t][0];r=m.iconRange[t][1];if(q<=r){s.attr("src",m.path+p)}if(q==r){t++}}else{s.attr("src",m.path+m.starOn)}}else{s.attr("src",m.path+m.starOff)}}}function j(l,n){var k=l.data("options"),m="";if(n!=0){n=parseInt(n,10);m=(n>0&&k.number<=k.hintList.length&&k.hintList[n-1]!==null)?k.hintList[n-1]:n}else{m=k.noRatedMsg}l.attr("title",m).children("img").attr("title",m)}function h(k){return k.is("input")||k.is("select")||k.is("textarea")}function e(l,m){var k=l.data("options"),n=l.attr("id");if(isNaN(parseInt(m,10))){l.children("img."+n).attr("src",k.path+k.starOff);d("input#"+n+"-score").removeAttr("value");return}if(m<0){m=0}else{if(m>k.number){m=k.number}}b(l,m);if(k.halfShow){g(l,m)}d("input#"+n+"-score").val(m);if(k.readOnly||l.css("cursor")=="default"){j(l,m)}}function g(l,o){var n=(o-Math.floor(o)).toFixed(2);if(n>0.25){var k=l.data("options"),m=k.starOn;if(n<0.76&&(k.half||k.halfShow)){m=k.starHalf}d("img#"+l.attr("id")+"-"+Math.ceil(o)).attr("src",k.path+m)}}d.fn.raty.cancel=function(k,m){var l=(m===undefined)?false:true;if(l){return d.fn.raty.click("",k,"cancel")}else{return d.fn.raty.start("",k,"cancel")}};d.fn.raty.click=function(n,k){var m=i(n,k,"click");if(k.indexOf(".")>=0){return}e(m,n);var l=d(k).data("options");c(n,l);if(l.click){l.click.apply(m,[n])}else{a(k+': you must add the "click: function(score, evt) { }" callback.')}return m};d.fn.raty.readOnly=function(n,l){var m=i(n,l,"readOnly");if(l.indexOf(".")>=0){return}var o=m.children("img.button-cancel");if(o[0]){(n)?o.hide():o.show()}if(n){d("img."+m.attr("id")).unbind();m.css("cursor","default").unbind()}else{var k=d(l).data("options");f(m,k);m.css("cursor","pointer")}return m};d.fn.raty.start=function(n,k){var m=i(n,k,"start");if(k.indexOf(".")>=0){return}e(m,n);var l=d(k).data("options");c(n,l);return m};function i(o,l,k){var m=undefined;if(l==undefined){a("Specify an ID or class to be the target of the action.");return}if(l){if(l.indexOf(".")>=0){var n;return d(l).each(function(){n="#"+d(this).attr("id");if(k=="start"){d.fn.raty.start(o,n)}else{if(k=="click"){d.fn.raty.click(o,n)}else{if(k=="readOnly"){d.fn.raty.readOnly(o,n)}}}})}m=d(l);if(!m.length){a('"'+l+'" is a invalid identifier for the public funtion $.fn.raty.'+k+"().");return}}return m}function a(k){if(window.console&&window.console.log){window.console.log(k)}}d.fn.raty.defaults={cancel:false,cancelHint:"cancel this rating!",cancelOff:"cancel-off.png",cancelOn:"cancel-on.png",cancelPlace:"left",click:null,half:false,halfShow:true,hintList:["bad","poor","regular","good","gorgeous"],noRatedMsg:"not rated yet",number:5,path:"img/",iconRange:[],readOnly:false,scoreName:"score",size:16,starHalf:"star-half.png",starOff:"star-off.png",starOn:"star-on.png",start:0,target:null,targetKeep:false,targetOutValue:"",targetType:"hint",width:null}})(jQuery);
