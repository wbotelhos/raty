/*!
 * jQuery Raty - A Star Rating Plugin
 *
 * Licensed under The MIT License
 *
 * @version        2.4.5
 * @author         Washington Botelho
 * @documentation  wbotelhos.com/raty
 *
 */

(function(d){var b={init:function(a){return this.each(function(){var c=d(this).empty();this.opt=d.extend(!0,{},d.fn.raty.defaults,a);c.data("settings",this.opt);this.opt.number="function"==typeof this.opt.number?this.opt.number.call(this):b.between(this.opt.number,0,20);this.opt.path?"/"!=this.opt.path.substring(this.opt.path.length-1,this.opt.path.length)&&(this.opt.path+="/"):this.opt.path="";"function"==typeof this.opt.score&&(this.opt.score=this.opt.score.call(this));this.opt.score&&(this.opt.score=
b.between(this.opt.score,0,this.opt.number));for(var e=1;e<=this.opt.number;e++)d("<img />",{src:this.opt.path+(!this.opt.score||this.opt.score<e?this.opt.starOff:this.opt.starOn),alt:e,title:e<=this.opt.hints.length&&null!==this.opt.hints[e-1]?this.opt.hints[e-1]:e}).appendTo(this),this.opt.space&&c.append(e<this.opt.number?"&#160;":"");this.stars=c.children('img:not(".raty-cancel")');this.score=d("<input />",{type:"hidden",name:this.opt.scoreName}).appendTo(this);this.opt.score&&0<this.opt.score&&
(this.score.val(this.opt.score),b.roundStar.call(this,this.opt.score));this.opt.iconRange&&b.fill.call(this,this.opt.score);b.setTarget.call(this,this.opt.score,this.opt.targetKeep);var e=this.opt.space?4:0,g=this.opt.width||this.opt.number*this.opt.size+this.opt.number*e;this.opt.cancel&&(this.cancel=d("<img />",{src:this.opt.path+this.opt.cancelOff,alt:"x",title:this.opt.cancelHint,"class":"raty-cancel"}),"left"==this.opt.cancelPlace?c.prepend("&#160;").prepend(this.cancel):c.append("&#160;").append(this.cancel),
g+=this.opt.size+e);this.opt.readOnly?(b.fixHint.call(this),this.cancel&&this.cancel.hide()):(c.css("cursor","pointer"),b.bindAction.call(this));c.css("width",g)})},between:function(a,c,b){return Math.min(Math.max(parseFloat(a),c),b)},bindAction:function(){var a=this,c=d(a);c.mouseleave(function(){var c=a.score.val()||void 0;b.initialize.call(a,c);b.setTarget.call(a,c,a.opt.targetKeep);a.opt.mouseover&&a.opt.mouseover.call(a,c)});var e=a.opt.half?"mousemove":"mouseover";a.opt.cancel&&a.cancel.mouseenter(function(){d(this).attr("src",
a.opt.path+a.opt.cancelOn);a.stars.attr("src",a.opt.path+a.opt.starOff);b.setTarget.call(a,null,!0);a.opt.mouseover&&a.opt.mouseover.call(a,null)}).mouseleave(function(){d(this).attr("src",a.opt.path+a.opt.cancelOff);a.opt.mouseover&&a.opt.mouseover.call(a,a.score.val()||null)}).click(function(c){a.score.removeAttr("value");a.opt.click&&a.opt.click.call(a,null,c)});a.stars.bind(e,function(e){var f=parseInt(this.alt,10);if(a.opt.half){var i=parseFloat((e.pageX-d(this).offset().left)/a.opt.size),h=
0.5<i?1:0.5,f=parseFloat(this.alt)-1+h;b.fill.call(a,f);a.opt.precision&&(f=f-h+i);b.showHalf.call(a,f)}else b.fill.call(a,f);c.data("score",f);b.setTarget.call(a,f,!0);a.opt.mouseover&&a.opt.mouseover.call(a,f,e)}).click(function(b){a.score.val(a.opt.half||a.opt.precision?c.data("score"):this.alt);a.opt.click&&a.opt.click.call(a,a.score.val(),b)})},cancel:function(a){return d(this).each(function(){if(!0===d(this).data("readonly"))return this;a?b.click.call(this,null):b.score.call(this,null);this.score.removeAttr("value")})},
click:function(a){return d(this).each(function(){if(!0===d(this).data("readonly"))return this;b.initialize.call(this,a);this.opt.click?this.opt.click.call(this,a):b.error.call(this,'you must add the "click: function(score, evt) { }" callback.');b.setTarget.call(this,a,!0)})},error:function(a){d(this).html(a);d.error(a)},fill:function(a){for(var c=this.stars.length,b=0,d,f,i,h=1;h<=c;h++)d=this.stars.eq(h-1),this.opt.iconRange&&this.opt.iconRange.length>b?(f=this.opt.iconRange[b],i=this.opt.single?
h==a?f.on||this.opt.starOn:f.off||this.opt.starOff:h<=a?f.on||this.opt.starOn:f.off||this.opt.starOff,h<=f.range&&d.attr("src",this.opt.path+i),h==f.range&&b++):(i=this.opt.single?h==a?this.opt.starOn:this.opt.starOff:h<=a?this.opt.starOn:this.opt.starOff,d.attr("src",this.opt.path+i))},fixHint:function(){var a=d(this),c=parseInt(this.score.val(),10),b=this.opt.noRatedMsg;!isNaN(c)&&0<c&&(b=c<=this.opt.hints.length&&null!==this.opt.hints[c-1]?this.opt.hints[c-1]:c);a.data("readonly",!0).css("cursor",
"default").attr("title",b);this.score.attr("readonly","readonly");this.stars.attr("title",b)},getScore:function(){var a=[],c;d(this).each(function(){c=this.score.val();a.push(c?parseFloat(c):void 0)});return 1<a.length?a:a[0]},readOnly:function(a){return this.each(function(){var c=d(this);if(c.data("readonly")===a)return this;this.cancel&&(a?this.cancel.hide():this.cancel.show());a?(c.unbind(),c.children("img").unbind(),b.fixHint.call(this)):(b.bindAction.call(this),b.unfixHint.call(this));c.data("readonly",
a)})},reload:function(){return b.set.call(this,{})},roundStar:function(a){var c=(a-Math.floor(a)).toFixed(2);if(c>this.opt.round.down){var b=this.opt.starOn;c<this.opt.round.up&&this.opt.halfShow?b=this.opt.starHalf:c<this.opt.round.full&&(b=this.opt.starOff);this.stars.eq(Math.ceil(a)-1).attr("src",this.opt.path+b)}},score:function(){return arguments.length?b.setScore.apply(this,arguments):b.getScore.call(this)},set:function(a){this.each(function(){var b=d(this),e=b.data("settings"),g=b.clone().removeAttr("style").insertBefore(b);
b.remove();g.raty(d.extend(e,a))});return d(this.selector)},setScore:function(a){return d(this).each(function(){if(!0===d(this).data("readonly"))return this;b.initialize.call(this,a);b.setTarget.call(this,a,!0)})},setTarget:function(a,c){if(this.opt.target){var e=d(this.opt.target);0==e.length&&b.error.call(this,"target selector invalid or missing!");var g=a,g=!c||void 0===g?this.opt.targetText:"hint"==this.opt.targetType?null===g&&this.opt.cancel?this.opt.cancelHint:this.opt.hints[Math.ceil(g-1)]:
this.opt.precision?parseFloat(g).toFixed(1):g;0>this.opt.targetFormat.indexOf("{score}")&&b.error.call(this,'template "{score}" missing!');null!==a&&(g=this.opt.targetFormat.toString().replace("{score}",g));e.is(":input")?e.val(g):e.html(g)}},showHalf:function(a){var b=(a-Math.floor(a)).toFixed(1);0<b&&0.6>b&&this.stars.eq(Math.ceil(a)-1).attr("src",this.opt.path+this.opt.starHalf)},initialize:function(a){a=!a?0:b.between(a,0,this.opt.number);b.fill.call(this,a);0<a&&(this.opt.halfShow&&b.roundStar.call(this,
a),this.score.val(a))},unfixHint:function(){for(var a=0;a<this.opt.number;a++)this.stars.eq(a).attr("title",a<this.opt.hints.length&&null!==this.opt.hints[a]?this.opt.hints[a]:a);d(this).data("readonly",!1).css("cursor","pointer").removeAttr("title");this.score.attr("readonly","readonly")}};d.fn.raty=function(a){if(b[a])return b[a].apply(this,Array.prototype.slice.call(arguments,1));if("object"===typeof a||!a)return b.init.apply(this,arguments);d.error("Method "+a+" does not exist!")};d.fn.raty.defaults=
{cancel:!1,cancelHint:"cancel this rating!",cancelOff:"cancel-off.png",cancelOn:"cancel-on.png",cancelPlace:"left",click:void 0,half:!1,halfShow:!0,hints:["bad","poor","regular","good","gorgeous"],iconRange:void 0,mouseover:void 0,noRatedMsg:"not rated yet",number:5,path:"img/",precision:!1,round:{down:0.25,full:0.6,up:0.76},readOnly:!1,score:void 0,scoreName:"score",single:!1,size:16,space:!0,starHalf:"star-half.png",starOff:"star-off.png",starOn:"star-on.png",target:void 0,targetFormat:"{score}",
targetKeep:!1,targetText:"",targetType:"hint",width:void 0}})(jQuery);